/*! pePlayer 21-11-2014 */
function getGlobalContainer(){var a;return"undefined"!=typeof module?a=module:"undefined"!=typeof window&&(window.exports=window.exports||{},a=window),a}!function(a){a.exports=function(a){"use strict";function b(){this.map.panTo(this.user.getPosition())}function c(){var a,b;for(b=new google.maps.LatLngBounds(null),b=b.extend(this.user.getPosition()),a=this.markers.length;a>0;)b=b.extend(this.markers[a-1].marker.getPosition()),a--;b.isEmpty()||this.map.fitBounds(b)}function d(a,b,c,d,f){var h,i,j;if(this.markerIcon=f,"undefined"!=typeof this.currentLocation&&"undefined"==typeof this.map){h=new google.maps.LatLng(this.currentLocation.lat(),this.currentLocation.lng());var k=[{featureType:"all",stylers:[{saturation:0},{hue:"#e7ecf0"}]},{featureType:"road",stylers:[{saturation:-70}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"simplified"},{saturation:-60}]}];i={zoom:15,center:h,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,panControl:!1,zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,overviewMapControl:!1,rotateControl:!1,styles:k},google.maps.visualRefresh=!0,j=document.getElementById(b),this.map=new google.maps.Map(j,i),this.map?(n(),google.maps.event.addListener(this.map,"tilesloaded",function(){o()})):p.log(p.LEVEL.PRODUCTION,"Map not created."),this.user=g(this.map,h,"You are here."),this.user.setIcon(c)}e.call(this,a,d,b)}function e(a,c,d){var e;if(a.length>0){for(;this.markers.length>0;)e=this.markers.pop(),e.marker.setMap(null),e.circle.setMap(null);a.map(f.bind(this,c)),b.call(this)}$(d).gmap("refresh")}function f(a,b){var c,d,e,f=a(b);if(f){c=new google.maps.LatLng(f.proximity.lat,f.proximity.lng),d=g(this.map,c,f.title),d.setIcon(this.markerIcon),e=h(this.map,c,f);var i=new google.maps.InfoWindow({content:"<div class='mapInfoWindow'>"+f.teaser+"</div>"});google.maps.event.addListener(d,"click",function(){i.open(this.map,this),f.openPanel()}),this.markers.push({marker:d,circle:e})}}function g(a,b,c){var d={position:b,map:a,labelContent:c,labelAnchor:new google.maps.Point(22,0),labelClass:"labels",labelStyle:{opacity:.75},labelVisible:!0};return new q.MarkerWithLabel(d)}function h(a,b,c){var d={strokeColor:"#00FF00",strokeOpacity:.8,strokeWeight:2,fillColor:"#00FF00",fillOpacity:.15,center:b,map:a,radius:1e3*c.proximity.range};return new google.maps.Circle(d)}function i(a){var b,c;return-1!==this.currentLocation?(c=new google.maps.LatLng(a.proximity.lat,a.proximity.lng),b=l(c,this.currentLocation),b<a.proximity.range?!0:!1):!0}function j(a){this.currentLocation=a,"undefined"!=typeof this.user&&this.user.setPosition(this.currentLocation)}function k(a){var b,c;return-1!==this.currentLocation?(c=new google.maps.LatLng(a.proximity.lat,a.proximity.lng),b=l(c,this.currentLocation),(b-a.proximity.range).toFixed(2)):-1}function l(a,b){var c;if(a&&b){var d=m(a.lat()),e=m(a.lng()),f=m(b.lat()),g=m(b.lng()),h=6731;c=Math.acos(Math.sin(d)*Math.sin(f)+Math.cos(d)*Math.cos(f)*Math.cos(e-g))*h}else c=1/0;return c}function m(a){var b=a*Math.PI/180;return b}function n(){p.log(p.LEVEL.DEVELOPMENT,"START SPINNER"),$.mobile.loading("show",{text:$.mobile.loader.prototype.options.text,textVisible:$.mobile.loader.prototype.options.textVisible,theme:$.mobile.loader.prototype.options.theme,textonly:!1,html:$.mobile.loader.prototype.options.html})}function o(){p.log(p.LEVEL.DEVELOPMENT,"STOP SPINNER"),$.mobile.loading("hide")}var p=a.mhLog,q=require("src/js/markerWithLabel")(),r={};r.test={};var s={panToYou:b,panToMarkers:c,createMapView:d,itemInRange:i,updateLocation:j,getDistanceFromItem:k};return r.makeMap=function(){var a,b={user:{value:void 0,writable:!0,enumerable:!0},map:{value:void 0,writable:!0,enumerable:!0},currentLocation:{value:void 0,writable:!0,enumerable:!0},markers:{value:[],writable:!0,enumerable:!0},markerIcon:{value:"http://maps.google.com/mapfiles/kml/pal3/icon54.png",writable:!0,enumerable:!0}};return a=Object.create(s,b)},r}}(getGlobalContainer());