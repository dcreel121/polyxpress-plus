/*! peDesigner 21-11-2014 */
function getGlobalContainer(){var a;return"undefined"!=typeof module?a=module:"undefined"!=typeof window&&(window.exports=window.exports||{},a=window),a}!function(a){var b={};b.test={},a.exports=function(a,c){"use strict";function d(a,b){console.log("getAuthorByName.");var c=new XMLHttpRequest;c.onload=function(){var a;console.log("getAuthorByname..onload."),200===c.status?c.responseText?(a=JSON.parse(c.responseText),a&&b(a)):alert("Author does not exist.  Try again."):(l.log(l.LEVEL.PRODUCTION,"Error searching for author."),alert("Error occurred trying to find author."))},c.open("GET","/peAPI/author/search/"+a),c.send(null)}function e(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);l.log(l.LEVEL.DEBUG,"Successful Author Update."+a)}else l.log(l.LEVEL.PRODUCTION,"Error:  Author Update failed")},b.open("PUT","/peAPI/user/"+a._id),b.setRequestHeader("Content-Type","application/json"),b.send(JSON.stringify(a))}function f(a,b){l.log(l.LEVEL.DEBUG,"Inside getAuthorInformation");var c=new XMLHttpRequest;c.onload=function(){return 200===c.status?(k=JSON.parse(c.responseText),l.log(l.LEVEL.DEBUG,"getAuthorInformation: "+c.responseText),a(k),void b()):void l.log(l.LEVEL.PRODUCTION,"Getting author data failed with error code: "+c.status)},c.open("GET","/peAPI/user/self"),c.send(null)}function g(a){l.log(l.LEVEL.DEBUG,"Inside getAllStories");var b=new XMLHttpRequest;b.onload=function(){var c;200===b.status?(c=JSON.parse(b.responseText),m.populateStoryMap(c),a()):l.log(l.LEVEL.PRODUCTION,"Error retrieving user stories.")},b.open("GET","/peAPI/story/id/"+k._id),b.send(null)}function h(a){var b=new XMLHttpRequest;b.onload=function(){var c;200===b.status?(c=JSON.parse(b.responseText),m.populateChapterMap(c),a()):l.log(l.LEVEL.PRODUCTION,"Error retrieving user chapters.")},b.open("GET","/peAPI/chapter/id/"+k._id),b.send(null)}function i(a){var b=new XMLHttpRequest;b.onload=function(){var c;200===b.status?(c=JSON.parse(b.responseText),m.populateEventMap(c),a()):l.log(l.LEVEL.PRODUCTION,"Error retrieving user events.")},b.open("GET","/peAPI/event/id/"+k._id),b.send(null)}function j(a){alert("Error:\n"+a)}var k,l=c.mhLog,m=a?a:require("./peDesignerModel")(c);return b.checkAuth=function(a){l.log(l.LEVEL.DEBUG,"Inside checkAuth");var b=new XMLHttpRequest;b.onload=function(){if(200===b.status){var c=JSON.parse(b.responseText);return l.log(l.LEVEL.DEBUG,"checkAuth: "+JSON.stringify(c)),void a(c)}l.log(l.LEVEL.PRODUCTION,"Checking user authorization failed with error code: "+b.status)},b.open("GET","/peAPI/user/checkAuth"),b.send(null)},b.submitNewStory=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){var a=JSON.parse(d.responseText);m.storyMap.push(a),b.authorList.push(a._id),c(a._id)}else j("Failed to create story")},d.open("POST","/peAPI/story"),d.setRequestHeader("Content-Type","application/json"),d.send(JSON.stringify(a))},b.submitNewChapter=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var a=JSON.parse(c.responseText);m.chapterMap.push(a),b(a._id)}},c.open("POST","/peAPI/chapter"),c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(a))},b.submitNewEvent=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){var a=JSON.parse(c.responseText);m.eventMap.push(a),b(a._id)}},c.open("POST","/peAPI/event"),c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(a))},b.submitUpdateStory=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState&&200===d.status){var a=JSON.parse(d.responseText);m.updateStory(a),c()}},d.open("PUT","/peAPI/story/"+a),d.setRequestHeader("Content-Type","application/json"),d.send(JSON.stringify(b))},b.submitUpdateChapter=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState&&200===d.status){var a=JSON.parse(d.responseText);m.updateChapter(a),c()}},d.open("PUT","/peAPI/chapter/"+a),d.setRequestHeader("Content-Type","application/json"),d.send(JSON.stringify(b))},b.submitUpdateEvent=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState&&200===d.status){var a=JSON.parse(d.responseText);m.updateEvent(a),c()}},d.open("PUT","/peAPI/event/"+a),d.setRequestHeader("Content-Type","application/json"),d.send(JSON.stringify(b))},b.submitDeleteStory=function(a,b,c){var d=new XMLHttpRequest;d.onload=function(){var a;200===d.status&&(a=JSON.parse(d.responseText),m.deleteStory(a._id),b.authorList.splice(b.authorList.indexOf(a),1),c())},d.open("DELETE","/peAPI/story/"+a),d.send(null)},b.submitDeleteChapter=function(a,b){var c=new XMLHttpRequest;c.onload=function(){var a;200===c.status&&(a=JSON.parse(c.responseText),m.deleteChapter(a._id),b())},c.open("DELETE","/peAPI/chapter/"+a),c.send(null)},b.submitDeleteEvent=function(a,b){var c=new XMLHttpRequest;c.onload=function(){var a;200===c.status&&(a=JSON.parse(c.responseText),m.deleteEvent(a._id),b())},c.open("DELETE","/peAPI/event/"+a),c.send(null)},b.authorSearch=function(a,b){a&&d(a,b)},b.updateAuthor=function(a){e(a)},b.getAuthorData=function(a){l.log(l.LEVEL.DEBUG,"Inside server getAuthorData"),f(a,g.bind(void 0,h.bind(void 0,i.bind(void 0,function(){l.log(l.LEVEL.DEBUG,"Events all done")}))))},b}}(getGlobalContainer());